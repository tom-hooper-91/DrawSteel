name: Build and deploy a container app

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
      
      - name: Build and push
        uses: docker/build-push-action@v6
        with:
          context: ./src/Web
          file: ./src/Web/Dockerfile
          push: true
          tags: thooper91/draw-steel:latest

  # deploy:
  #   permissions:
  #     contents: none
  #   runs-on: ubuntu-latest
  #   needs: build
  #   environment:
  #     name: 'Production'

    # steps:
    #     - name: Check out code
    #       uses: actions/checkout@v2

    #     - name: Log in to Azure
    #       uses: azure/login@v1
    #       with:
    #         creds: ${{ secrets.AZURE_CREDENTIALS }}

    #     - name: Build and deploy Container App
    #       uses: azure/container-apps-deploy-action@v0
    #       with:
    #         appSourcePath: ${{ github.workspace }}
    #         acrName: <Container-Registery-Name>
    #         acrUsername: ${{ secrets.REGISTRY_USERNAME }}
    #         acrPassword: ${{ secrets.REGISTRY_PASSWORD }}
    #         containerAppName: <Container-App-Name>
    #         containerAppEnvironment: <Container-App-Environment-Name>
    #         resourceGroup: <Container-App-Resource-Group>
    #         imageToBuild: <Container-Registry>/<Image-Name>:<Tag e.g. ${{ github.sha }}>
    #         dockerfilePath: /Path/to/Dockerfile